(function(c){c.fn.treeselect=function(d){var d=c.extend({colwidth:18,default_value:{},selected:null,treeloaded:null,load:null,deepLoad:!1,onbuild:null,postbuild:null,inputName:"treeselect",showRoot:!1,selectAll:!1,selectAllText:"Select All"},d),i={},e=function(a,b){this.root=!!b;a.title=a.title||"anonymous";c.extend(this,{id:0,nodeloaded:!1,allLoaded:!1,value:0,title:"",url:"",has_children:!0,children:[],data:{},level:0,odd:!1,checked:!1,busy:!1,display:c(),input:c(),link:c(),span:c(),childlist:c()},
a);this.isTreeNode=!0};e.prototype.setBusy=function(a){a!=this.span.hasClass("treebusy")&&((this.busy=a)?this.span.addClass("treebusy"):this.span.removeClass("treebusy"))};e.prototype.isLoaded=function(){var a=this.nodeloaded,a=a|i.hasOwnProperty(this.id),a=a|!this.has_children;return a|=this.has_children&&0<this.children.length};e.prototype.loadNode=function(a,b){d.load&&!this.isLoaded()?(b||this.setBusy(!0),d.load(this,function(f){return function(c){f=jQuery.extend(f,c);f.nodeloaded=!0;i[f.id]=
f.id;f.build();a&&a(f);b||f.setBusy(!1)}}(this))):a&&a(this)};e.prototype.loadAll=function(a,b,c,d){d=d||{};this.loadNode(function(e){b&&b(e);var h=e.children.length,g=h;if(!h||d.hasOwnProperty(e.id))a&&a(e);else{d[e.id]=e.id;for(c||e.setBusy(!0);h--;)e.children[h].loadAll(function(){g--;g||(a&&a(e),c||e.setBusy(!1))},b,c,d)}})};e.prototype.expand=function(a){this.checked=this.input.is(":checked");a?(this.link.removeClass("collapsed").addClass("expanded"),this.span.removeClass("collapsed").addClass("expanded"),
this.childlist.show("fast")):0<this.span.length&&(this.link.removeClass("expanded").addClass("collapsed"),this.span.removeClass("expanded").addClass("collapsed"),this.childlist.hide("fast"));a&&!this.isLoaded()&&this.loadNode(function(a){a.checked&&a.select(a.checked);a.expand(true)})};e.prototype.selectChildren=function(a){for(var b=this.children.length;b--;)this.children[b].select(a,!0)};e.prototype.check=function(a){this.checked=a;this.input.attr("checked",a);d.selected&&d.selected(this,!0)};e.prototype.select=
function(a,b){this.checked=a;this.input.attr("checked",a);this.checked&&d.deepLoad?this.loadAll(function(c){c.selectChildren(a);d.selected&&d.selected(c,!b)}):(this.selectChildren(a),d.selected&&d.selected(this,!b))};e.prototype.build_treenode=function(){var a=c(),a=c(document.createElement(this.root?"div":"li"));a.addClass("treenode");a.addClass(this.odd?"odd":"even");return a};e.prototype.build_input=function(a){if(d.inputName){this.input=c(document.createElement("input"));var b=this.value||this.id;
this.input.attr({type:"checkbox",value:b,name:d.inputName+"-"+b,checked:this.checked});this.input.css("left",a+"px");this.input.bind("click",function(a){return function(b){b=c(b.target).is(":checked");a.expand(b);a.select(b)}}(this));this.root&&!d.showRoot&&this.input.hide()}return this.input};e.prototype.build_link=function(a){a.css("cursor","pointer").addClass("collapsed");a.bind("click",{node:this},function(a){a.preventDefault();a.data.node.expand(c(a.target).hasClass("collapsed"))});return a};
e.prototype.build_span=function(a){if((!this.root||this.showRoot)&&this.has_children)this.span=this.build_link(c(document.createElement("span")).attr({"class":"treeselect-expand"})),this.span.css("left",a+"px");return this.span};e.prototype.build_title=function(a){if((!this.root||this.showRoot)&&this.title)this.nodeLink=c(document.createElement("a")).attr({"class":"treeselect-title",href:this.url,target:"_blank"}).css("marginLeft",a+"px").text(this.title),this.link=this.has_children?this.build_link(this.nodeLink.clone()):
c(document.createElement("div")).attr({"class":"treeselect-title"}).css("marginLeft",a+"px").text(this.title);return this.link};e.prototype.build_children=function(){this.childlist=c();if(0<this.children.length){this.childlist=c(document.createElement("ul"));var a=this.odd,b;for(b in this.children)this.children.hasOwnProperty(b)&&(a=!a,this.children[b]=new e(c.extend(this.children[b],{level:this.level+1,odd:a,checked:this.checked})),this.childlist.append(this.children[b].build()))}return this.childlist};
e.prototype.build=function(){var a=5,b=null;if(0==this.display.length)this.display=this.build_treenode();else if(this.root){var f=this.build_treenode();this.display.append(f);this.display=f}if(0==this.input.length&&(b=this.build_input(a))&&0<b.length)this.display.append(b),a+=d.colwidth;0==this.span.length&&(this.display.append(this.build_span(a)),a+=d.colwidth);0==this.link.length&&this.display.append(this.build_title(a));0==this.childlist.length&&this.display.append(this.build_children());if(d.onbuild)d.onbuild(this);
this.searchItem=this.display.clone();c(".treeselect-expand",this.searchItem).remove();a=c("div.treeselect-title",this.searchItem);0<a.length&&a.replaceWith(this.nodeLink);d.postbuild&&d.postbuild(this);return this.display};e.prototype.getSelectAll=function(){return this.root&&this.selectAll?this.selectAllText:!1};e.prototype.setDefault=function(a,b){jQuery.isEmptyObject(a)?b&&b(this):this.loadAll(function(a){b&&b(a)},function(b){(a.hasOwnProperty(b.value)||a.hasOwnProperty(b.id))&&b.check(!0)})};
e.prototype.search=function(a,b){if(a){var c={},a=a.toLowerCase();this.loadAll(function(){b&&b(c,!0)},function(b){!b.root&&-1!==b.title.toLowerCase().search(a)&&(c[b.id]=b)},!0)}else b&&b(this.children,!1)};return c(this).each(function(){var a=c.extend(d,{display:c(this)}),a=this.treenode=new e(a,!0),b=a.getSelectAll();!1!==b&&!a.showRoot&&(a.display.append(c(document.createElement("input")).attr({type:"checkbox"}).bind("click",function(a){return function(b){a.selectChildren(c(b.target).is(":checked"));
d.selected&&d.selected(a,!0)}}(a))),b&&(b=c(document.createElement("span")).attr({"class":"treeselect-select-all"}).html(b),a.display.append(b)));a.loadNode(function(a){a.children.length==0&&a.display.hide();a.checked&&a.select(a.checked);a.expand(true);a.setDefault(d.default_value,function(a){d.treeloaded&&d.treeloaded(a)})});a.has_children||(this.parentElement.style.display="none")})}})(jQuery);
(function(c){c.fn.chosentree=function(d){d=c.extend({inputId:"chosentree-select",label:"",description:"",input_placeholder:"Select Item",input_type:"text",no_results_text:"No results found",min_height:100,more_text:"+%num% more",loaded:null,collapsed:!0,showtree:!1},d);return c(this).each(function(){var i=null,e=null,a=null,b=null,f=null,o=null,m=null,h=f=null,g=null,n=function(a){a&&(null==g||g.has_children)?h.addClass("treevisible").show("fast"):h.removeClass("treevisible").hide("fast")},i=c(document.createElement("div"));
i.addClass("chzntree-container");"search"==d.input_type?(i.addClass("chzntree-container-single"),a=c(document.createElement("div")),a.addClass("chzntree-search")):(i.addClass("chzntree-container-multi"),e=c(document.createElement("ul")),e.addClass("chzntree-choices chosentree-choices"),a=c(document.createElement("li")),a.addClass("search-field"));f=c(document.createElement("label"));f.attr({"for":d.inputId});f.text(d.label);m=c(document.createElement("div"));m.attr({"class":"description"});m.text(d.description);
if(d.input_placeholder){b=c(document.createElement("input"));b.attr({type:"text",placeholder:d.input_placeholder,autocomplete:"off"});!d.showtree&&d.collapsed&&b.focus(function(){n(true)});if("search"==d.input_type){b.addClass("chosentree-search");var q=0,j="";b.bind("input",function r(){j=b.val();if(!b.hasClass("searching")&&j.length!==1){if(g){b.addClass("searching");g.search(j,function(a){return function(c,e){b.removeClass("searching");if(j!=a)r();else{var f=0;g.childlist.children().detach();e?
g.childlist.addClass("chzntree-search-results"):g.childlist.removeClass("chzntree-search-results");for(var h in c){f++;e?g.childlist.append(c[h].searchItem):g.childlist.append(c[h].display)}f||g.childlist.append("<li>"+d.no_results_text+"</li>")}}}(j))}}else{clearTimeout(q);q=setTimeout(r,1E3)}})}else b.addClass("chosentree-results");a.append(b)}e?i.append(f).append(e.append(a)):i.append(f).append(a);h=c(document.createElement("div"));h.addClass("treewrapper");h.hide();o=c(document.createElement("span")).attr({"class":"tree-loading treebusy"}).css("display",
"block");f=c(document.createElement("div"));f.addClass("treeselect");c(this).keyup(function(a){a.which==27&&n(false)});h.append(f.append(o));c(this).append(i.append(h));c(this).append(m);var k=d,p=this;k.selected=function(f,h){var g=c("li#choice_"+f.id,e);if(f.id)if(f.checked&&g.length==0){g=c(document.createElement("li"));g.addClass("search-choice");g.attr("id","choice_"+f.id);g.eq(0)[0].nodeData=f;var i=c(document.createElement("span"));i.text(f.title);if(!f.root||f.showRoot&&f.has_children){var l=
c(document.createElement("a"));l.addClass("search-choice-close");l.attr("href","javascript:void(0)");l.bind("click",function(a){a.preventDefault();c("li#choice_"+f.id,e).remove();f.select(false)})}a.before(g.append(i).append(l))}else f.checked||g.remove();if(h){var j=[];p.value={};e.show();b&&f.children.length==0&&b.attr({value:""});c("li.search-choice",e).each(function(){p.value[this.nodeData.id]=this.nodeData.value;j.push(this.nodeData)});if(jQuery.fn.moreorless){l=d.more_text.replace("%num%",j.length);
e.moreorless(d.min_height,l);e.div_expanded||n(true,null)}k.loaded&&k.loaded(j);c(p).trigger("treeloaded")}};k.treeloaded=function(){o.remove()};f.treeselect(k);g=f.eq(0)[0].treenode;(k.showtree||!k.collapsed)&&n(!0,null)})}})(jQuery);
